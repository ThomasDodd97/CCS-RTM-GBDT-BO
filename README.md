# CCS-RTM-GBDT-BO
Carbon Capture Storage (CCS) relevant Reactive Transport Modelling (RTM) of microfractures in basaltic rock; emulated using Gradient Boosted Decision Trees (GBDT) and subsequently optimised using Bayesian Optimisation (BO) framework.

# Introduction

In 2022 a master's of research project on the subject of optimisation of CCS with respect to the mineralisation of carbon that takes place when CO2 saturated fluid is pumped into fractured basaltic rock. The aim of this was to potentially find out what the best aqueous species compositions would be for injected carbonated fluids that are pumped down into such fractured basaltic fields of rock.

From the outset it was noted that one of the key geochemical environments in which carbon mineralisation takes place are dead-end microfractures, where diffusion is the dominant transport mechanism moving aqueous species. It was therefore decided that a basaltic rock fracture would be modelled. To model this, a reactive transport modelling software by the name of [Crunchtope](https://bitbucket.org/crunchflow/crunchtope-dev/wiki/Home) was used to simulate the behaviour of geochemical conditions in time and space.

Initially evolution of the chemistry in such a rock was confined to a **basaltic cube model (bcm)** which didn't involve any transport processes and was effectively carried out in a single block of the 3D space thatCrunchTope can work within; this made it a 0D model.

This model progressed from a simple model with the correct volume fractions of the major mineral groups (bcm_1 sub-series), to a model detailing all the primary minerals themselves and their respective rates (bcm_2 sub-series), to a variety of models containing unserpentinised/serpentinised basalts (bcm_3 sub-series) (A great deal of referencing to the user manual was required to get as far as I did find it [here](https://netl.doe.gov/sites/default/files/netl-file/CrunchFlow-Manual.pdf)). The wider bcm test series culminated in the bcm_4 sub-series which incorporated primary/secondary species, all the necessary minerals and their thermodynamic/kinetic rates, a porosity within the cube to emulate a fractured space through which fluid could percolate, and the specific surface areas expected of the individual minerals. Many of the parameterisations cams from two key papers, one by [Xiong et al. 2017](https://www.sciencedirect.com/science/article/pii/S1750583617305595?via%3Dihub) and the other by [Liu et al. 2019](https://www.sciencedirect.com/science/article/pii/S1750583618309009?via%3Dihub). And study of these papers later led to the development of the bfm.

The **basaltic flow model (bfm)** model series, despite the slightly misleading titling, that might be more suggestive of advection as opposed to diffusion, was aimed at modelling a basaltic fracture in 1D as opposed to the simple 0D model developed previously.

This model series progressed by initially 



# Notes
File types that may be encountered when carrying out future work in this project area:
* **.in** files parameterise runs carried out by CrunchTope.
* **.out** files are output files generated by CrunchTope after a  run.
* **.tec** files are another type of output file generated by CrunchTope, can be read like a csv with a little googling.
* **.dbs** files specify all the kinetic and thermodynamic properties of minerals, species, gases etc for your CrunchTope run; .in files must reference .dbs files when they are read by CrunchTope.
* **.ant** files are catchily entitled 'PestControl' and are placed in folder next to RTM runs for user-friendliness purposes. When one of these files exists in a directory and has the correct .in file name written into it in plain text you can fire up CrunchTope and run the referenced .in file from the command line if you are in the same directory. Note you will stil need to have to have set up a CrunchTope alias in your shell.
* **.ipynb** files are jupyter notebook files for mixed workflow between python and markdown. These files visualise almost all of the work done within this project.
* **.yaml** files have been used for the purpose of instructing the Omphalos CrunchTope wrapper of how to carry out large-scale distributed RTM run batches.
* **.pkl** files have been used for the purpose of containing large datasets of RTM runs and their outputs in a python friendly manner; due to their multi-GB size when they come out the other end of an Omphalos workflow, they have not been submitted to this GitHub page for fear of the dreaded size limit message...
* **.txt** files are plain text notes on what the individual models were geared towards at the time of development; things have been busy so please accept my apologies in advance for scarcity of note taking at times in these!
* **.json** files have been used for the purpose of storing information during bayesian optimisation processes, they contain target and predictor values. Another storage fuction for this file type has been the stowing of XGB models themselves for later booting up and querying.
* **.yml** a yaml file that has the purpose of providing an automatic way of setting up a conda environment for use with all the packages required in this project.

Systems that might be required during work on this subject area:
* [Visual Studio Code](https://code.visualstudio.com/) -  Not necessarily required, but works well alongside the syntax highlighters I developed for working effectively with the [.in](https://github.com/ThomasDodd97/CF-IF-LS) and [.out](https://github.com/ThomasDodd97/CF-OF-LS) and [.dbs](https://github.com/ThomasDodd97/CF-DF-LS) files that CrunchTope requires the manual editing of.
* [Jupyter Notebooks](https://jupyter.org/) - Programming environment that allows supports python, julia, R, and markdown simultaneously.
* [CrunchTope/CrunchFlow](https://bitbucket.org/crunchflow/crunchtope-dev/wiki/Home) - RTM software for development of geochemical environments
* [PETSc](https://petsc.org/release/) - Portable Extensible Toolkit for Scientific Computation; partial differential equation solving utility that is required for CrunchTope to function correctly.
* [Omphalos](https://github.com/a-fotherby/Omphalos) - A python based wrapper for CrunchTope facilitating the generation of thousands of .in files and subsequent distributed running of the associated RTM runs.
* [Weights and Biases](https://wandb.ai/site) - A webapp that can interlink with jupyter notebooks to keep track of machine learning training sessions.
* [XGBoost](https://xgboost.readthedocs.io/en/stable/) - A library that can be used from a python based environment to carryout GBDT upon datasets to train models of data, can be deployed from a jupyter notebook environment.
* [BayesianOptimization](https://github.com/fmfn/BayesianOptimization) - A github based project that implements bayesian optimisation in a python based environment, can be sued within jupyter notebook to optimise black-box functions such as those generated by XGBoost!
* [Conda](https://docs.conda.io/en/latest/) - package manager for keeping track of multiple development environments within jupyter notebooks etc.

Websites of notable utility during the course of this project:
* Pennsylvania State University Website - A damned useful [course](https://www.e-education.psu.edu/png550/node/829) giving the basics on how to use CrunchTope to run RTM simulations.
* Thermoddem Website - A useful [resource](https://thermoddem.brgm.fr/) for lookup of all minerals and their associated thermochemical and mineralogical properties.
* SUPCRTBL Website - An [webapp](https://models.earth.indiana.edu/supcrtbl.php) capable of generating thermodynamic property tables for most mineral dissolution reaction you might have in mind.b